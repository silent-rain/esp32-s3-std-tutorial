# DMA 介绍

## DMA 介绍：

DMA 是直接存储器访问的缩写，它是一种调制技术，可以在不占用 CPU 资源的情况下，实现外设和存储器之间或者存储器和存储器之间的高速数据传输。

DMA 的作用是提高系统的效率和性能，减少数据拷贝次数，实现 CPU 的零参与，彻底消除 CPU 在这方面的负载。

DMA 的使用场景主要是一些高速的外设 I/O 设备，如磁盘控制器、网卡、显卡、声卡等。这些设备传输字节或字的速度非常快，如果用输入输出指令或采用中断的方法来传输字节信息，会大量占用 CPU 的时间，同时也容易造成数据的丢失。而 DMA 方式能使 I/O 设备直接和存储器进行成批数据的快速传送。

DMA 的使用方法一般是通过配置 DMA 控制器的相关寄存器，来设置 DMA 的传输方向、传输数据量、传输地址、传输模式、传输优先级、传输中断等参数，然后启动 DMA 传输，等待 DMA 传输完成或出错时产生中断，再进行相应的处理。

## DMA 的工作过程概括：

- CPU 通过编程 DMA 控制器的相关寄存器，来设置 DMA 的传输参数，并启动 DMA 传输。
- DMA 控制器根据传输参数，从外设或存储器的源地址读取数据，并暂存到 DMA 的缓冲区（FIFO）中。
- DMA 控制器根据缓冲区的阈值，将缓冲区的数据写入到外设或存储器的目标地址中，并更新 DMA 的计数器。
- DMA 控制器重复上述步骤，直到传输完成或出错，然后产生中断信号，通知 CPU 处理结果。

## ESP32-S3 的 DMA 功能可以用于以下场景：

- 与 PSRAM（伪静态随机存取存储器）的通信，实现内存同步和扩展。
- 与 SPI（串行外设接口）的通信，实现高速闪存读写和其他 SPI 设备的控制。
- 与 I2S（集成声音总线）的通信，实现音频输入输出和其他 I2S 设备的控制。
- 与 UART（通用异步收发器）的通信，实现串口数据传输和其他 UART 设备的控制。
- 与 GDMA（通用 DMA）的通信，实现多种外设之间的数据传输，如 RMT（远程控制器）、TWAI（两线异步接口）、LCD（液晶显示器）、SDMMC（安全数字多媒体卡）等。
- esp-idf-svc 库是一个为 ESP32-S3 提供各种服务（如 WiFi，网络，HTTP，日志等）的类型安全的 Rust 封装。它没有单独的 DMA 模块，但是它提供了一些与 DMA 相关的外设的驱动，如 SPI，I2S，UART，GDMA 等。您可以使用这些驱动来配置和控制 DMA 功能，或者直接使用 ESP-IDF 的 DMA API。
